#!/usr/bin/env bash

FILE_NAMES=()

for file in "$(chezmoi source-path)/dot_config/"*.src.ini; do
  base=$(basename "$file")
  name="${base#private_}"
  name="${name%%.src*}"
  FILE_NAMES+=("$name")
done

CONFIGDIR="$HOME/.config"

# Monitor the named pipe and run update command on change
inotifywait -m -e delete --format="%f" "$CONFIGDIR" | while read -r file; do
  not_lock="${file%%.lock*}"
  if [[ ${FILE_NAMES[*]} =~ $not_lock ]]; then
    chezmoi_modify_manager --add "$CONFIGDIR/$not_lock"
  fi
done
